var app=app||{};app.App={init:function(){console.log("App.init");var a=this;$("html,body").animate({scrollTop:0},500),this.bindEvents(),Background.init(),Sidebar.init(),Widgets.init(),setTimeout(function(){a.mQBreakpoints()},500)},bindEvents:function(){console.log("App.bindEvents");var a=this;$(window).on("resize",_.throttle(function(){a.imagesRecalc()},1e3)),this.mql={},this.mql.s=window.matchMedia("(max-width: 700px)"),this.mql.s.addListener(function(){a.mQBreakpoints()}),$("body").on("scroll",function(){console.log("Body scrolling",$("body").height(),$("body").scrollTop())})},imagesRecalc:function(){$("#widget_wrapper img").not(".size-full").each(function(){var a=$(this).width();$(this).hasClass("portrait")&&(a=$(this).height()),a<=300?newSrc=$(this).attr("data-thm"):a>300&&a<=600?newSrc=$(this).attr("data-med"):a>600&&a<=768?newSrc=$(this).attr("data-mdl"):a>768&&a<=900?newSrc=$(this).attr("data-lrg"):newSrc=$(this).attr("data-xlg"),newSrc!==$(this).attr("src")&&($(this).attr("src",newSrc),console.log(41,"Src changed."))})},imageCalc:function(a,b){console.log("App.imageCalc");var c,d,e=a["thumbnail-width"],f=a["thumbnail-height"],g=$("#widget_wrapper").width()-24;return c="one-quarter"===b?.25*g:"one-third"===b?.33*g:"one-half"===b?.5*g:.67*g,f>e&&(c/=e/f,b+=" portrait"),d=c<=300?a.thumbnail:c>300&&c<=600?a.medium:c>600&&c<=768?a.medium_large:c>768&&c<=900?a.large:a.extralarge,"<img class='"+b+"' \t\t\tsrc='"+d+"' \t\t\tdata-thm='"+a.thumbnail+"' \t\t\tdata-med='"+a.medium+"' \t\t\tdata-mdl='"+a.medium_large+"' \t\t\tdata-lrg='"+a.large+"' \t\t\tdata-xlg='"+a.extralarge+"' />"},mQBreakpoints:function(){console.log("App.mQBreakpoints"),this.mql.s.matches?(console.log("mql.s"),""===$("#main_contact").html()&&$("#contact").clone().attr("id","").appendTo("#main_contact")):$("#main_contact").hide()},targetBlank:function(){console.log("App.targetBlank"),$("#widget_wrapper a").each(function(){$(this).hasClass("internal")||$(this).attr("target","_blank")})},newsHtmlPrep:function(){console.log("App.newsHtmlPrep"),$(".news_widget .text_block img").each(function(){$(this).parent("a").length&&$(this).unwrap();var a,b=$(this).attr("height")/$(this).attr("width");a=b>=1?45:b<1&&b>.5?67:b<.5&&b>.3?80:100,$(this).wrap("<div class='image_wrapper'></div>").css({width:a+"%"}),$(this).parents("p").find("a").css({"margin-left":-4})}),$(".news_widget").fadeIn(1e3)}},$(function(){moment().format(),app.App.init();new app.MainRouter;Backbone.history.start({}),app.Nav.init()});var Background={init:function(){console.log("Background.init");var a=this;this.bindEvents(),this.imagesCalc(),_.defer(function(){a.slideshowInit()})},bindEvents:function(){console.log("Background.bindEvents");var a=this;$(window).on("resize",_.throttle(function(){a.imagesCalc()},500))},imagesCalc:function(){console.log("Background.imagesCalc"),$("#bg_image li").each(function(){var a,b,c=parseFloat($(this).attr("data-ratio")),d=$(window).width()/$(window).height();a=d<c?$(window).height()*c:$(window).width(),console.log(51,d,c,a),b=a<=300?$(this).attr("data-thm"):a>300&&a<=600?$(this).attr("data-med"):a>600&&a<=900?$(this).attr("data-lrg"):$(this).attr("data-xlg"),b!==$(this).attr("src")&&$(this).css("background-image","url("+b+")")})},slideshowInit:function(){console.log("Background.slideshowInit"),$("#bg_image li").first().addClass("visible");var a=8e3;setTimeout(function(){setInterval(function(){var a=$("#bg_image .visible");a.removeClass("visible"),a.next().length?a.next().addClass("visible"):$("#bg_image li").first().addClass("visible")},8e3)},a)}},app=app||{};app.Nav={projectsVisible:!1,menuHidden:!0,init:function(){var a=this;$("#projects_toggle").on("click",function(b){b.preventDefault(),a.toggleProjects()}),$(document).on("click",function(b){$(event.target).closest("#projects_hidden").length||$(event.target).closest("#projects_toggle").length||(console.log("Click outside."),a.projectsVisible?(console.log("Projects are visible."),$("#projects_hidden").hide(),a.projectsVisible=!1):console.log("Projects are not visible."))}),$("#lang_selec a").on("click",function(a){a.preventDefault(),app.Nav.langSelec($(this))}),$("#nav a").on("click",function(){"projects_toggle"!==$(this).attr("id")&&_.defer(a.menuHide())}),$("#nav_toggle a").on("click",function(b){b.preventDefault(),$("#nav_toggle").addClass("small_screen_hide"),$("#nav").removeClass("small_screen_hide"),a.menuHidden=!1,console.log(45,a.menuHidden)}),$(document).on("click",function(b){console.log(52,a.menuHidden),$(event.target).closest("#nav").length||$(event.target).closest("#nav_toggle").length||(console.log(49),a.menuHidden===!1&&a.menuHide())})},menuHide:function(){console.log("Nav.menuHide"),$("#nav_toggle").removeClass("small_screen_hide"),$("#nav").addClass("small_screen_hide"),self.menuHidden=!0},toggleProjects:function(){this.projectsVisible?($(window).width()<=700?$("#mobile_projects_hidden").hide():$("#projects_hidden").hide(),this.projectsVisible=!1):($(window).width()<=700?(console.log(96),$("#mobile_projects_hidden").show()):$("#projects_hidden").show(),this.projectsVisible=!0)},langSelec:function(a){console.log("Nav.langSelec"),a.hasClass("lang_en")?($(".lang_fr").removeClass("selected"),$(".lang_en").addClass("selected"),$(".fr").hide(),$(".en").show()):a.hasClass("lang_fr")&&($(".lang_en").removeClass("selected"),$(".lang_fr").addClass("selected"),$(".en").hide(),$(".fr").show())}};var app=app||{};app.MainRouter=Backbone.Router.extend({newsPrepped:!1,routes:{news:"showLatestNews","news/:id":"showNewsItem",biography:"showBiography","projects/:id":"showProjectItem",concerts:"showConcerts",discography:"showDiscography",links:"showLinks",contact:"showContact","*other":"showHome"},exists:function(a){return $("#"+a).length},navTo:function(a){console.log("Router.navTo",a);var b=$("#nav").outerHeight()+40;$(window).width()<=700&&(b=40),_.defer(function(){$("html, body").animate({scrollTop:$("#"+a).offset().top-b},1e3)})},showHome:function(){console.log("showHome"),Backbone.history.navigate("news"),this.newsPrepped?(console.log("Nav to news."),this.navTo("news")):(app.App.newsHtmlPrep(),this.newsPrepped=!0)},showLatestNews:function(){console.log("showLatestNews"),this.newsPrepped?(console.log("Nav to news."),this.navTo("news")):(app.App.newsHtmlPrep(),this.newsPrepped=!0)},showNewsItem:function(){console.log("showNewsItem")},showBiography:function(){console.log("showBiography"),this.exists("biography")||($("#widget_wrapper").append("<section id='biography'></section>"),new app.BiographyView),this.navTo("biography")},showProjectItem:function(a){console.log("showProjectItem",a);var b=this;$("html,body").animate({scrollTop:0},50,function(){b.exists("projects")?(console.log(146),$("#project-"+a).length?b.navTo("project-"+a):new app.ProjectsView({id:a})):(console.log(140),$("#widget_wrapper").append("<section id='projects'></section>"),new app.ProjectsView({id:a}))})},showConcerts:function(){console.log("showConcerts"),this.exists("concerts")||($("#widget_wrapper").append("<section id='concerts'></section>"),new app.ConcertsView),this.navTo("concerts")},showDiscography:function(){console.log("showDiscography"),this.exists("discography")||($("#widget_wrapper").append("<section id='discography'></section>"),new app.DiscographyView),this.navTo("discography")},showLinks:function(){console.log("showLinks"),this.exists("links")||($("#widget_wrapper").append("<section id='links'></section>"),new app.LinksView),this.navTo("links")},showContact:function(){console.log("showContact"),$(window).width()<=700?this.navTo("main_contact"):this.navTo("contact")}});var Sidebar={newsletterVisible:!1,init:function(){console.log("Sidebar.init"),this.calcTopOffset(),this.bindEvents(),this.show()},bindEvents:function(){console.log("Sidebar.bindEvents");var a=this;$("#newsletter_toggle a").on("click",function(b){b.preventDefault(),a.newsletterVisible?($("#newsletter_form").css({height:""}),a.newsletterVisible=!1):($("#newsletter_form").css({height:"150px"}),a.newsletterVisible=!0)}),$(window).on("scroll",_.throttle(function(){$("#sidebar").is(":visible")&&a.pinCheck($(window).scrollTop())},100))},show:function(){console.log("Sidebar.show"),$("#sidebar .widget").each(function(){var a=$(this);_.delay(function(){a.fadeIn(1e3)},1e3)})},calcTopOffset:function(){console.log("Sidebar.calcTopOffset"),this.soundcloudOffset=$("#nav").height()+40,this.soundcloudTop=$(".soundcloud_widget").offset().top-this.soundcloudOffset},pinCheck:function(a){console.log("Sidebar.pinCheck")}},Widgets={init:function(){console.log("Widgets.init"),this.concertsInit()},concertsInit:function(){console.log("Widgets.concertsInit"),$(".concerts_list").each(function(){var a=$(this).children().length;if(a>12&&$(this).prev(".concerts_filter").length){var b=(new Date).getFullYear();$(this).find(".concert").each(function(){parseInt($(this).attr("data-year"))!==b&&$(this).removeClass("concert_visible")})}else $(this).prev(".concerts_filter").hide()}),$(".concert_filter").on("click",function(a){a.preventDefault();var b=$(this).text();$(this).parents(".concerts_filter").next(".concerts_list").find(".concert").each(function(){$(this).attr("data-year")===b?$(this).addClass("concert_visible"):$(this).removeClass("concert_visible")})})}};